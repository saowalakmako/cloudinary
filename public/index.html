<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cloudinary</title>
  <style>
    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      font-family: 'Mochiy Pop One', sans-serif;
    }

    #box {
      background-color: bisque;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      border-radius: 8px;
    }

    #inputBox {
      padding: 4px 4px 4px 8px;
      border-radius: 15px;
      background-color: lightgray;
      width: 280px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    #inputText {
      border: none;
      outline: none;
      line-height: 28px;
      width: 230px;
      font-size: small;
      background-color: lightgray;
      color: dimgray;
      font-family: 'Mochiy Pop One', sans-serif;
    }

    #svgBinocular {
      cursor: pointer;
      text-align: right;
    }

    #fileProps {
      display: none;
      font-size: xx-small;
      padding: 8px;
      background-color: lightgray;
      border-radius: 8px;
    }

    #imgBox {
      display: none;
      margin-top: 10px;
      justify-content: center;
      align-items: center;
    }

    .imgPreview {
      height: 100px;
      width: auto;
    }

    #uploadBox {
      display: none;
      flex-direction: column;
      justify-content: space-evenly;
      align-items: center;
      padding: 8px;
      background-color: aquamarine;
      border-radius: 8px;
    }

    #uploadButton {
      cursor: pointer;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }

    #uploadHash {
      font-size: xx-small;
    }
    #result {
      display: none;
      margin-top: 8px;
      font-size: small;
      background-color: aqua;
      padding: 8px;
      border-radius: 8px;
    }
    #clear {
      margin-top: 30px;
      width: 100%;
      display: flex;
      justify-content: end;
      align-items: center;
      cursor: pointer;
    }
  </style>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Mochiy+Pop+One&display=swap" rel="stylesheet">
</head>

<body>
  <h1>Cloudinary</h1>
  <div id="box">
    <h2>Browse an Image for Upload</h2>
    <div>
      <div id="inputBox">
        <input id="inputText" type="text" disabled />
        <svg id="svgBinocular" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="40px" height="40px">
          <path
            d="M98.829,67.685c-1.717-11.958-11.7-40.128-13.796-46.259C83.246,16.197,76.693,14,71,14	c-7.193,0-13.636,4.555-16.032,11.334c-0.328,0.928-0.573,1.878-0.735,2.845C53.502,28.061,52.756,28,52,28	s-0.534,0.061-1.265,0.179c-0.162-0.967-0.407-1.917-0.735-2.845C47.604,18.555,40.193,14,33,14c-5.693,0-12.246,2.197-14.034,7.426	c-2.096,6.13-12.079,34.301-13.796,46.259C3.42,79.882,15.155,90,27.5,90c7.774,0,14.776-3.966,18.835-10.202	C48.083,80.581,50.004,81,52,81s3.917-0.419,5.665-1.202C61.724,86.034,68.726,90,76.5,90C88.845,90,100.58,79.882,98.829,67.685z"
            opacity=".35" />
          <path fill="#f2f2f2"
            d="M96.829,65.685c-1.717-11.958-11.7-40.128-13.796-46.259C81.246,14.197,74.693,12,69,12	c-7.193,0-13.636,4.555-16.032,11.334c-0.328,0.928-0.573,1.878-0.735,2.845C51.502,26.061,50.756,26,50,26	s-1.502,0.061-2.233,0.179c-0.162-0.967-0.407-1.917-0.735-2.845C44.636,16.555,38.193,12,31,12c-5.693,0-12.246,2.197-14.034,7.426	c-2.096,6.13-12.079,34.301-13.796,46.259C1.42,77.882,13.155,88,25.5,88c7.774,0,14.776-3.966,18.835-10.202	C46.083,78.581,48.004,79,50,79s3.917-0.419,5.665-1.202C59.724,84.034,66.726,88,74.5,88C86.845,88,98.58,77.882,96.829,65.685z" />
          <circle cx="25.5" cy="65.5" r="17.5" fill="#707cc0" />
          <circle cx="74.5" cy="65.5" r="17.5" fill="#707cc0" />
          <path fill="#707cc0"
            d="M43,29c0,6.627-5.373,12-12,12s-12-5.373-12-12s5.373-12,12-12c5.225,0,9.67,3.339,11.317,8	C42.759,26.251,43,27.597,43,29z" />
          <circle cx="69" cy="29" r="12" fill="#707cc0" />
          <path fill="#707cc0"
            d="M80.317,25L57,29v5.456C55.384,32.358,52.853,31,50,31s-5.384,1.358-7,3.456V29l-23.325-4	L8.904,59.933L39,56.434L43,66h14l3-9.566l31.411,4.546L80.317,25z" />
          <path fill="#40396e"
            d="M50,31c-2.853,0-5.384,1.358-7,3.456V38v7.224V66h14V45.224V38v-3.544	C55.384,32.358,52.853,31,50,31z"
            opacity=".35" />
          <circle cx="50" cy="65.16" r="8.84" fill="#707cc0" />
          <path fill="#40396e"
            d="M69,20c3.799,0,7.205,2.412,8.475,6.003c0.019,0.053,0.039,0.105,0.06,0.156 c0.003,0.011,0.007,0.022,0.01,0.032c0.031,0.093,0.059,0.187,0.099,0.325l10.616,34.431c0.005,0.016,0.01,0.033,0.015,0.049 c0.044,0.136,0.086,0.273,0.138,0.448l0.024,0.078c0.014,0.077,0.032,0.154,0.052,0.231C88.828,63.018,89,64.279,89,65.5 C89,73.495,82.495,80,74.5,80c-6.654,0-12.431-4.513-14.047-10.975c-0.293-1.173-1.262-2.055-2.458-2.238 c-0.152-0.023-0.303-0.034-0.453-0.034c-1.034,0-2.01,0.536-2.56,1.437C53.908,69.95,52.046,71,50,71s-3.908-1.05-4.982-2.81 c-0.55-0.901-1.526-1.437-2.56-1.437c-0.15,0-0.302,0.011-0.453,0.034c-1.195,0.182-2.164,1.065-2.458,2.238 C37.931,75.487,32.154,80,25.5,80C17.505,80,11,73.495,11,65.5c0-1.552,0.257-3.104,0.764-4.614 c0.04-0.118,0.072-0.238,0.096-0.359l10.543-34.193l-0.015-0.005c0.009-0.019,0.018-0.037,0.027-0.056l0.007,0.002l0.016-0.052 c0.032-0.072,0.061-0.145,0.087-0.22C23.795,22.413,27.201,20,31,20c3.809,0,7.22,2.411,8.489,6C39.828,26.96,40,27.969,40,29 v5.456c0,1.284,0.817,2.426,2.033,2.84c0.318,0.108,0.644,0.16,0.967,0.16c0.913,0,1.798-0.418,2.377-1.169 C46.496,34.833,48.181,34,50,34s3.504,0.833,4.623,2.287c0.579,0.752,1.464,1.169,2.377,1.169c0.323,0,0.649-0.052,0.967-0.16 C59.183,36.882,60,35.74,60,34.456V29C60,24.037,64.037,20,69,20 M69,17c-6.627,0-12,5.373-12,12v5.456 C55.384,32.358,52.853,31,50,31s-5.384,1.358-7,3.456V29c0-1.403-0.241-2.749-0.683-4C40.67,20.339,36.225,17,31,17 c-5.224,0-9.656,3.344-11.304,8.004L19.675,25l-0.121,0.392c-0.009,0.028-0.018,0.057-0.026,0.085L8.904,59.933l0.016-0.002 C8.332,61.682,8,63.551,8,65.5C8,75.165,15.835,83,25.5,83c8.195,0,15.055-5.641,16.958-13.247C44.01,72.297,46.802,74,50,74 s5.99-1.703,7.542-4.247C59.445,77.359,66.305,83,74.5,83C84.165,83,92,75.165,92,65.5c0-1.567-0.225-3.078-0.612-4.523 l0.022,0.003l-0.13-0.421c-0.049-0.167-0.099-0.332-0.153-0.497L80.512,25.632c-0.037-0.127-0.075-0.253-0.116-0.378L80.317,25 l-0.014,0.002C78.655,20.344,74.224,17,69,17L69,17z" />
          <circle cx="50" cy="64" r="3" fill="#40396e" />
          <circle cx="25.5" cy="65.5" r="11.5" fill="#40396e" />
          <path fill="#fff"
            d="M19,67c-0.829,0-1.5-0.672-1.5-1.5c0-4.411,3.589-8,8-8c0.829,0,1.5,0.672,1.5,1.5 s-0.671,1.5-1.5,1.5c-2.757,0-5,2.243-5,5C20.5,66.328,19.829,67,19,67z" />
          <circle cx="74.5" cy="65.5" r="11.5" fill="#40396e" />
          <path fill="#fff"
            d="M68,67c-0.829,0-1.5-0.672-1.5-1.5c0-4.411,3.589-8,8-8c0.829,0,1.5,0.672,1.5,1.5 s-0.671,1.5-1.5,1.5c-2.757,0-5,2.243-5,5C69.5,66.328,68.829,67,68,67z" />
        </svg>
      </div>
      <input id="inputFile" type="file" hidden accept="image/*" />
      <div id="imgBox"></div>
    </div>
    <p id="fileProps"></p>
    <div id="uploadBox">
      <p id="uploadHash"></p>
      <div id="uploadButton">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="40px" height="40px">
          <path
            d="M21.068,84c-0.151,0-0.301-0.005-0.45-0.016 C11.951,83.74,4.931,76.517,4.931,67.793c0-6.617,4.006-12.418,9.824-14.907c0.325-2.617,1.225-5.158,2.693-7.592 c2.799-4.644,7.305-7.892,12.361-8.91C31.086,36.129,32.382,36,33.664,36c0.07,0,0.14,0,0.209,0.001 c1.845-4.602,5.025-8.549,9.235-11.381c4.106-2.761,8.873-4.221,13.789-4.221c2.455,0,4.935,0.362,7.37,1.075 c7.31,2.14,13.253,7.713,15.9,14.909c0.909,2.475,1.44,5.04,1.583,7.604c1.888,0.26,3.753,0.793,5.569,1.594 c5.335,2.35,9.442,7.1,10.988,12.706c1.713,6.217,0.524,12.671-3.263,17.708c-3.675,4.887-9.256,7.791-15.337,7.988 C79.547,83.994,79.386,84,79.225,84H21.068z"
            opacity=".35" />
          <path fill="#f2f2f2"
            d="M19.068,82c-0.151,0-0.301-0.005-0.45-0.016c-8.666-0.243-15.686-7.467-15.686-16.19 c0-6.617,4.006-12.418,9.824-14.907c0.325-2.617,1.225-5.158,2.693-7.592c2.799-4.644,7.305-7.892,12.361-8.91 C29.086,34.129,30.382,34,31.664,34c0.07,0,0.14,0,0.209,0.001c1.845-4.602,5.025-8.549,9.235-11.381 c4.106-2.761,8.873-4.221,13.789-4.221c2.455,0,4.935,0.362,7.37,1.075c7.31,2.14,13.253,7.713,15.9,14.909 c0.909,2.475,1.44,5.04,1.583,7.604c1.888,0.26,3.753,0.793,5.569,1.594c5.335,2.35,9.442,7.1,10.988,12.706 c1.713,6.217,0.524,12.671-3.263,17.708c-3.675,4.887-9.256,7.791-15.337,7.988C77.547,81.994,77.386,82,77.225,82H19.068z" />
          <path fill="#70bfff"
            d="M82.953,49.246c-3.717-1.638-7.269-1.531-10.341-0.415c1.218-3.792,1.296-8.098-0.342-12.554 c-1.951-5.307-6.341-9.442-11.743-11.024c-11.944-3.498-22.873,4.752-24.01,15.919c-2.266-0.975-4.87-1.31-7.59-0.763 c-3.432,0.69-6.354,2.949-8.169,5.959c-2.074,3.441-2.242,6.64-1.563,9.51c-0.118-0.004-0.234-0.018-0.353-0.018 c-5.39,0-9.759,4.395-9.759,9.816c0,5.42,4.368,9.814,9.756,9.816L18.838,75.5h58.583l-0.001-0.009 c8.733-0.11,15.497-8.447,12.956-17.666C89.324,54.008,86.56,50.836,82.953,49.246z" />
          <path fill="#40396e"
            d="M77.421,77H18.838c-0.061,0-0.12-0.003-0.18-0.011c-6.123-0.1-11.075-5.138-11.075-11.314 c0-5.758,4.301-10.525,9.844-11.227c-0.34-3.063,0.346-6.034,2.047-8.855c2.098-3.48,5.436-5.906,9.157-6.655 c2.25-0.452,4.522-0.374,6.671,0.22c1.025-5.219,4.065-9.822,8.529-12.825c5.031-3.384,11.108-4.278,17.117-2.519 c5.851,1.713,10.608,6.179,12.729,11.946c1.326,3.61,1.664,7.355,1.004,10.969c2.954-0.519,5.976-0.133,8.876,1.145 c4.014,1.769,7.104,5.339,8.265,9.552c1.311,4.757,0.412,9.679-2.464,13.505c-2.817,3.747-7.093,5.948-11.751,6.057 C77.546,76.996,77.483,77,77.421,77z M19.007,74h58.252c0.047-0.005,0.095-0.008,0.143-0.009c3.786-0.047,7.271-1.82,9.559-4.863 c2.313-3.076,3.031-7.051,1.97-10.905c-0.924-3.353-3.385-6.195-6.582-7.604h-0.001c-3.076-1.356-6.181-1.483-9.223-0.378 c-0.539,0.195-1.141,0.068-1.553-0.329c-0.413-0.397-0.563-0.994-0.388-1.539c1.199-3.737,1.089-7.741-0.322-11.578 c-1.793-4.878-5.814-8.655-10.757-10.102c-5.136-1.505-10.322-0.748-14.599,2.129c-4.246,2.856-6.979,7.414-7.497,12.502 c-0.048,0.476-0.32,0.899-0.732,1.141c-0.411,0.242-0.915,0.274-1.353,0.085c-2.093-0.901-4.409-1.132-6.701-0.67 c-2.898,0.583-5.516,2.501-7.18,5.263c-1.631,2.705-2.085,5.449-1.388,8.39c0.107,0.456-0.004,0.936-0.301,1.298 s-0.744,0.558-1.215,0.547l-0.298-0.017c-4.554,0-8.259,3.73-8.259,8.315c0,4.584,3.704,8.314,8.258,8.316 C18.896,73.991,18.951,73.994,19.007,74z" />
          <line x1="50.5" x2="50.5" y1="65.5" y2="44.5" fill="none" stroke="#40396e" stroke-linecap="round"
            stroke-linejoin="round" stroke-miterlimit="10" stroke-width="3" />
          <line x1="42.5" x2="50.5" y1="50.5" y2="44.5" fill="none" stroke="#40396e" stroke-linecap="round"
            stroke-linejoin="round" stroke-miterlimit="10" stroke-width="3" />
          <line x1="50.5" x2="58.5" y1="44.5" y2="50.5" fill="none" stroke="#40396e" stroke-linecap="round"
            stroke-linejoin="round" stroke-miterlimit="10" stroke-width="3" />
        </svg>
        <span>Upload</span>
      </div>
    </div>
    <div id="result">x</div>
    <div id="clear">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="40px" height="40px">
        <path
          d="M37.297,94.938c-4.641,0-8.578-3.319-9.363-7.894l-8.278-48.311C16.967,37.937,15,35.443,15,32.5 C15,23.402,22.402,16,31.5,16h2.234c2.005-4.158,6.256-7,11.146-7h14.238c4.891,0,9.142,2.842,11.146,7H72.5 C81.598,16,89,23.402,89,32.5c0,2.707-1.664,5.033-4.022,6.009l-8.316,48.533c-0.781,4.573-4.719,7.896-9.362,7.896H37.297z"
          opacity=".35" />
        <path fill="#f2f2f2"
          d="M35.297,92.938c-4.641,0-8.578-3.319-9.363-7.894l-8.278-48.311C14.967,35.937,13,33.443,13,30.5 C13,21.402,20.402,14,29.5,14h2.234c2.005-4.158,6.256-7,11.146-7h14.238c4.891,0,9.142,2.842,11.146,7H70.5 C79.598,14,87,21.402,87,30.5c0,2.707-1.664,5.033-4.022,6.009l-8.316,48.533c-0.781,4.573-4.719,7.896-9.362,7.896H35.297z" />
        <path fill="#40396e"
          d="M63,25H37c-0.828,0-1.5-0.672-1.5-1.5v-4.119c0-4.069,3.312-7.381,7.381-7.381h14.238 c4.069,0,7.381,3.312,7.381,7.381V23.5C64.5,24.328,63.828,25,63,25z M38.5,22h23v-2.619c0-2.416-1.965-4.381-4.381-4.381H42.881 c-2.416,0-4.381,1.965-4.381,4.381V22z" />
        <polygon fill="#9aa2e6" points="22.806,28.303 32.767,86.438 67.828,86.438 77.79,28.303" />
        <path fill="#707cc0"
          d="M80.5,28.957h-61v0c0-4.671,3.787-8.457,8.457-8.457h44.085C76.713,20.5,80.5,24.287,80.5,28.957 L80.5,28.957z" />
        <path fill="#40396e"
          d="M65.299,87.938H35.297c-2.198,0-4.063-1.572-4.436-3.739L21.917,32H19.5c-0.828,0-1.5-0.672-1.5-1.5 C18,24.159,23.159,19,29.5,19h41C76.841,19,82,24.159,82,30.5c0,0.828-0.672,1.5-1.5,1.5h-1.822l-8.944,52.197 C69.363,86.364,67.498,87.938,65.299,87.938z M21.133,29h2.049c0.73,0,1.355,0.526,1.479,1.247l9.158,53.444 c0.124,0.722,0.746,1.246,1.479,1.246h30.002c0.732,0,1.354-0.524,1.478-1.246l9.158-53.444C76.058,29.526,76.683,29,77.413,29 h1.454c-0.71-3.974-4.192-7-8.367-7h-41C25.325,22,21.843,25.026,21.133,29z" />
        <path fill="#40396e"
          d="M38.647,76.944c-0.759,0-1.41-0.574-1.49-1.346l-3.86-37.445c-0.085-0.824,0.515-1.562,1.338-1.646 c0.82-0.08,1.561,0.514,1.646,1.338l3.86,37.445c0.085,0.824-0.515,1.562-1.338,1.646C38.751,76.941,38.699,76.944,38.647,76.944z" />
        <path fill="#40396e"
          d="M46.414,76.942c-0.805,0-1.47-0.638-1.498-1.448l-1.298-37.406 c-0.028-0.828,0.619-1.522,1.447-1.551c0.83-0.034,1.521,0.619,1.551,1.447l1.298,37.406c0.028,0.828-0.619,1.522-1.447,1.551 C46.449,76.942,46.432,76.942,46.414,76.942z" />
        <path fill="#40396e"
          d="M54.183,76.941c-0.018,0-0.034,0-0.052-0.001c-0.828-0.028-1.477-0.722-1.448-1.55l1.265-37.368 c0.027-0.828,0.746-1.492,1.55-1.448c0.828,0.028,1.477,0.722,1.448,1.55l-1.265,37.368C55.653,76.303,54.987,76.941,54.183,76.941 z" />
        <path fill="#40396e"
          d="M61.949,76.939c-0.052,0-0.103-0.003-0.155-0.008c-0.824-0.085-1.424-0.821-1.339-1.646 l3.827-37.328c0.085-0.824,0.818-1.412,1.646-1.339c0.824,0.085,1.424,0.821,1.339,1.646l-3.827,37.328 C63.36,76.364,62.709,76.939,61.949,76.939z" />
      </svg>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      let formData = new FormData();

      const svgBinocular = document.getElementById('svgBinocular');
      const inputFile = document.getElementById('inputFile');
      const inputText = document.getElementById('inputText');
      const fileProps = document.getElementById('fileProps');
      const uploadHash = document.getElementById('uploadHash');
      const imgBox = document.getElementById('imgBox');
      const result = document.getElementById('result');

      svgBinocular.addEventListener('click', async () => {
        inputFile.click();
        clearAll();
      });

      //https://developer.mozilla.org/en-US/docs/Web/API/File_API/Using_files_from_web_applications
      inputFile.addEventListener('change', () => {
        const file = inputFile.files[0];
        if (!file.type.startsWith('image/')) {
          inputText.value = '';
          fileProps.innerHTML = `<p style="color:red;font-size:16px">Invalid File Type</p>`;
          return;
        }
        inputText.value = file.name;
        const nBytes = file.size;
        let sOutput = nBytes + " bytes";
        const aMultiples = ["KiB", "MiB", "GiB", "TiB", "PiB", "EiB", "ZiB", "YiB"];
        for (nMultiple = 0, nApprox = nBytes / 1024; nApprox > 1; nApprox /= 1024, nMultiple++) {
          sOutput = nApprox.toFixed(3) + " " + aMultiples[nMultiple] + " (" + nBytes + " bytes)";
        }
        fileProps.style.display = 'block';
        fileProps.innerHTML = `
        <u>name:</u> ${file.name}
        <br/>
        <u>size:</u> ${sOutput}
        <br/>
        <u>type:</u> ${file.type}
        <br/>
        <u>lastModified:</u> ${new Date(file.lastModified)}
        `;

        imgBox.style.display = 'flex';
        const img = document.createElement("img");
        img.classList.add("imgPreview");
        img.file = file;
        imgBox.appendChild(img);
        const reader = new FileReader();
        reader.onload = (function (aImg) { return function (e) { aImg.src = e.target.result; }; })(img);
        reader.readAsDataURL(file);

        fetch('/.netlify/functions/hash', {
          method: 'POST',
          body: JSON.stringify({
            name: file.name,
            size: file.size,
            type: file.type,
            lastModified: file.lastModified
          })
        })
          .then(resp => resp.json())
          .then(result => {
            formData.append("file", file);
            formData.append("api_key", result.api_key);
            // formData.append("eager", "w_400,h_300,c_pad|w_260,h_200,c_crop");
            // formData.append("public_id", "sample_image");
            formData.append("timestamp", result.timestamp);
            formData.append("signature", result.hash);
            let textFormData = '';
            for (const [key, value] of formData) {
              textFormData += `<u>${key}</u>: ${value}<br />`;
            }
            uploadBox.style.display = 'flex';
            uploadHash.innerHTML = textFormData;
          });
      });

      const uploadButton = document.getElementById('uploadButton');
      uploadButton.addEventListener('click', () => {
        console.log('upload');
        const url = "https://api.cloudinary.com/v1_1/saowalakmako/auto/upload";
        fetch(url, {
          method: "POST",
          body: formData
        })
          .then((response) => {
            if (response.ok) {
              return response.json();
            }
            throw new Error(`${response.status} - ${response.statusText}`);
          })
          .then((data) => {
            // console.log(data);
            result.style.display = 'block';
            result.innerHTML = data.secure_url;
            result.style.backgroundColor = 'aqua';
            result.style.color = 'black';
          })
          .catch(err => {
            result.style.display = 'block';
            result.innerHTML = err;
            result.style.backgroundColor = 'crimson';
            result.style.color = 'white';
          });

      });

      function clearAll() {
        formData = new FormData();
        inputFile.value = '';
        inputText.value = '';

        imgBox.textContent = '';

        fileProps.innerHTML = '';
        fileProps.style.display = 'none';

        uploadBox.style.display = 'none';
        result.style.display = 'none';
      }
      const clear = document.getElementById('clear');
      clear.addEventListener('click', clearAll);

    })
  </script>
</body>

</html>